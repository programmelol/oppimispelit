<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lausekkeen arvo – oppimispeli</title>
<style>
  :root { --r: 16px; }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    background: #f6f7fb;
    color: #111827;
  }
  .wrap { min-height: 100vh; display: grid; place-items: center; padding: 24px; }
  .card {
    width: min(720px, 100%);
    background: #fff; border-radius: var(--r);
    box-shadow: 0 10px 30px rgba(0,0,0,.08);
    padding: 20px 20px 24px;
  }
  h1 { font-size: 20px; margin: 0 0 6px; }
  .sub { color: #6b7280; font-size: 14px; margin-bottom: 16px; }
  .question { font-size: 18px; line-height: 1.5; margin: 8px 0 16px; }
  code.expr {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    font-weight: 600;
  }
  .row { display: flex; gap: 12px; align-items: center; }
  input[type="text"] {
    flex: 1; height: 44px; padding: 0 12px;
    border: 1px solid #e5e7eb; border-radius: 10px; font-size: 16px; outline: none;
  }
  input[type="text"]:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,.15); }
  button {
    height: 44px; padding: 0 14px; border: 0; border-radius: 10px;
    background: #111827; color: #fff; font-size: 15px; cursor: pointer;
  }
  button[disabled] { opacity: .6; cursor: default; }
  .feedback { min-height: 28px; margin: 12px 0 6px; }
  .ok { color: #065f46; }
  .no { color: #b91c1c; }
  .score { font-size: 14px; color: #6b7280; }
  .center { text-align: center; margin-top: 8px; }
  .hidden { display: none; }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Lausekkeen arvo – oppimispeli</h1>
      <div class="sub" id="progress">Kysymys 1/10</div>
      <div class="question" id="question"></div>
      <div class="row" id="inputRow">
        <input id="answer" type="text" inputmode="numeric" placeholder="Syötä vastaus" autocomplete="off" />
        <button id="checkBtn">Tarkista (Enter)</button>
      </div>
      <div class="feedback" id="feedback"></div>
      <div class="score" id="score">Pisteet: 0</div>
      <div class="center hidden" id="endView">
        <p style="font-weight:600; font-size:18px; margin: 6px 0 8px">Peli päättyi!</p>
        <p id="finalScore"></p>
        <button id="restartBtn">Pelaa uudestaan</button>
      </div>
    </div>
  </div>

<script>
(function(){
  const TOTAL = 10;
  let questions = [];
  let idx = 0;
  let score = 0;
  let checked = null; // true/false/null
  let advanceTimer = null;

  const elQ = document.getElementById('question');
  const elProg = document.getElementById('progress');
  const elAns = document.getElementById('answer');
  const elCheck = document.getElementById('checkBtn');
  const elFeedback = document.getElementById('feedback');
  const elScore = document.getElementById('score');
  const endView = document.getElementById('endView');
  const finalScore = document.getElementById('finalScore');
  const inputRow = document.getElementById('inputRow');
  const restartBtn = document.getElementById('restartBtn');

  function randInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

  function formatExpr(a, b) {
    // Sievennykset: 1x -> x, -1x -> -x. Spacing: "5x + 4".
    const aPart = a === 1 ? 'x' : (a === -1 ? '-x' : a + 'x');
    let expr = aPart;
    if (b > 0) expr += ' + ' + b;
    else if (b < 0) expr += ' - ' + Math.abs(b);
    return expr;
  }

  function makeQuestion() {
    let a = 0;
    while (a === 0) a = randInt(-10, 10); // ei nollakerrointa
    const b = randInt(-10, 10);
    const x = randInt(-10, 10);
    const value = a * x + b;
    return { a, b, x, value };
  }

  function makeQuiz(n = TOTAL) {
    const qs = [];
    while (qs.length < n) {
      const q = makeQuestion();
      if (!qs.some(p => p.a === q.a && p.b === q.b && p.x === q.x)) qs.push(q);
    }
    return qs;
  }

  function render() {
    clearTimeout(advanceTimer);
    elProg.textContent = `Kysymys ${Math.min(idx+1, TOTAL)}/${TOTAL}`;
    const q = questions[idx];
    elQ.innerHTML = `Mikä on lausekkeen <code class="expr">${formatExpr(q.a, q.b)}</code> arvo, kun <code class="expr">x = ${q.x}</code>?`;
    elScore.textContent = `Pisteet: ${score}`;
    elFeedback.textContent = '';
    elAns.value = '';
    elAns.disabled = false;
    elCheck.disabled = false;
    checked = null;
    elCheck.textContent = 'Tarkista (Enter)';
    elAns.focus();
  }

  function autoAdvance() {
    // Siirrytään automaattisesti seuraavaan 1.2 sekunnin kuluttua
    advanceTimer = setTimeout(() => {
      if (idx + 1 >= TOTAL) endGame(); else nextQuestion();
    }, 1200);
  }

  function checkAnswer() {
    if (idx >= TOTAL) return;
    const q = questions[idx];
    if (checked !== null) return; // estä tuplat

    const userRaw = elAns.value.trim().replace(',', '.');
    const user = Number(userRaw);
    if (!userRaw || Number.isNaN(user)) {
      elFeedback.innerHTML = '<span class="no">Anna numeerinen vastaus.</span>';
      elAns.focus();
      return; // ei automaattista siirtymistä jos vastaus kelvoton
    }

    const ok = Math.abs(user - q.value) < 1e-9;
    checked = ok;
    if (ok) {
      score += 1;
      elFeedback.innerHTML = `<span class="ok">Oikein! Vastaus on ${q.value}.</span>`;
    } else {
      elFeedback.innerHTML = `<span class="no">Ei aivan. Oikea vastaus on ${q.value}.</span>`;
    }

    elScore.textContent = `Pisteet: ${score}`;
    elAns.disabled = true;
    elCheck.disabled = true;
    autoAdvance();
  }

  function nextQuestion() {
    idx += 1;
    if (idx >= TOTAL) { endGame(); return; }
    render();
  }

  function endGame() {
    clearTimeout(advanceTimer);
    elProg.textContent = `Kysymys ${TOTAL}/${TOTAL}`;
    elQ.innerHTML = '';
    elFeedback.textContent = '';
    inputRow.classList.add('hidden');
    endView.classList.remove('hidden');
    finalScore.textContent = `Sait ${score} / ${TOTAL} pistettä.`;
  }

  function resetGame() {
    questions = makeQuiz(TOTAL);
    idx = 0;
    score = 0;
    checked = null;
    endView.classList.add('hidden');
    inputRow.classList.remove('hidden');
    render();
  }

  // Tapahtumat
  document.getElementById('checkBtn').addEventListener('click', checkAnswer);
  elAns.addEventListener('keydown', (e) => { if (e.key === 'Enter') checkAnswer(); });
  restartBtn.addEventListener('click', resetGame);

  // Käynnistys
  questions = makeQuiz(TOTAL);
  render();
})();
</script>
</body>
</html>

